<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>用户管理 - 管理员端</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <a class="navbar-brand" href="#">在线图书销售系统</a>
        <div class="navbar-nav">
            <a class="nav-link" href="/admin/bookManage.html">图书管理</a>
            <a class="nav-link active" href="/admin/userManage.html">用户管理</a>
            <a class="nav-link" href="/admin/orderManage.html">订单管理</a>
            <!-- 新增这一行：销售榜链接 -->
            <a class="nav-link" href="/admin/saleStat.html">销售榜</a>
        </div>
        <div class="navbar-nav ms-auto">
            <span class="nav-link text-white" id="adminName">管理员</span>
            <button class="btn btn-light ms-2" id="logoutBtn">退出登录</button>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-header bg-light py-3">
            <h5 class="mb-0">普通用户列表</h5>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-dark">
                    <tr>
                        <th>用户ID</th>
                        <th>登录账号</th>
                        <th>手机号</th>
                    </tr>
                    </thead>
                    <tbody id="userTableBody">
                    <tr>
                        <td colspan="4" class="text-center text-muted py-3">加载中...</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    $(function() {
        // 检查登录状态
        checkLoginStatus();

        // 退出登录
        $("#logoutBtn").click(() => window.location.href = "/admin/login.html");

        // 加载用户列表
        function loadUserList() {
            $.get("/admin/user/list", function(users) {
                let html = "";
                if (users && users.length > 0) {
                    users.forEach(user => {
                        html += `
                            <tr>
                                <td>${user.userId || '-'}</td>
                                <td>${user.loginName || '-'}</td>
                                <td>${user.phonenumber || '-'}</td>
                            </tr>
                        `;
                    });
                } else {
                    html = `<tr><td colspan="4" class="text-center text-muted py-3">暂无用户数据</td></tr>`;
                }
                $("#userTableBody").html(html);
            }).fail(() => {
                $("#userTableBody").html(`<tr><td colspan="4" class="text-center text-danger py-3">加载失败，请刷新页面</td></tr>`);
            });
        }

        // 检查登录状态
        function checkLoginStatus() {
            $.get("/admin/checkLogin", function(res) {
                if (!res.success) {
                    window.location.href = "/admin/login.html";
                } else {
                    loadUserList();
                }
            }).fail(() => {
                alert("登录状态检查失败");
                window.location.href = "/admin/login.html";
            });
        }
    });
</script>
</body>
</html>